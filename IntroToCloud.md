# KTB 클라우드 과정 필기 노트 / 7월 3일 (3일차) - Cloud

## 커리큘럼
1. 풀스택 공부
2. AWS, GDP 공부

## 그 전에 배울 것
- 클라우드란 ? : 
    - 컴퓨터 네트워크를 통해 인터넷 상에서 데이터 저장, 컴퓨팅 파워, 소프트웨어 등을 제공하는 기술
    - 인터넷 상에서 여러 리소스를 원할 때마다 쓰는 것
    
- 리소스를 제공한다는 것은 ?
    1. 리소스를 그대로 통째로 빌려주는 방법
    2. 큰 서버에서 사용자가 원하는 만큼만 서버로 만들어 제공해주기 -> 이 떄 사용되는 기술이 바로 가상화 `(Virtualization)`

- 가상화 개념
    - 물리적인 자원을 추상화하여 가상 자원을 만들어 관리하는 기술
    - 예를 들어 안드로이드 에뮬레이터
    - 방법
        1. 가상화 소프트웨어 사용하기
        ```
          가상환경            가상환경
        Application     Application
          미들웨어            미들웨어
          게스트OS           게스트OS
                가상화 소프트웨어
                   호스트OS
                   하드웨어
        ```

        2. 하이퍼바이저 가상화 (엔지니어들이 주로 사용하는 방법)
        ```
          가상환경            가상환경
        Application     Application
          미들웨어            미들웨어
            OS                OS
                  하이퍼바이저(Xen, KVM)
                   하드웨어
        ```
        - PV, HVM / Bare-Metal Hypervisor -> PV는 현실적으로 어렵다? 

        3. 컨테이너 가상화  (Linux Container, Docker 등등) 
        - 컨테이너 관리 소프트웨어를 설치하여 논리적으로 컨테이너를 나누어 사용
        (나중에 배우기 때문에 그냥 넘어감)

- AWS에서는 어떤 가상화 개념을 사용할까?
    - 초반에는 PV 방식을 사용하다가 HVM 방식을 사용하고 있으며, 최근에는 Nitro System 사용하고 있다.
    - AWS ECS에서는 컨테이너 가상화를 활용하고 있다.
    - 하이퍼바이저 가상화 방식 !! -> 거의 모든 클라우드에서 사용하는 방식

- 가상화 종류
    1. 서버 가상화 : 하나의 물리적 서버를 여러 가상 서버로 분할하여 사용
    2. 데스크탑 가상화 : 사용자의 데스크탑을 환경을 가상화
    3. 애플리케이션 가상화 : 애플리케이션을 가상 환경에서 실행하여 운영 체제와 분리
    4. 네트워크 가상화 : 물리적 네트워크 자원을 가상화하여 여러 가상 네트워크를 생성
    5. 스토리지 가상화 : 물리적 스토리지를 추상화하여 논리적 스토리지 풀을 생성

- `Virtual Machine vs Bare Metal`
    - VM : PV or HVM 기반으로 생성되며 대부분의 클라우드 내 서버는 해당 방식으로 제공
    - Bare Metal : VM과는 다르게 통쨰로 빌려주는 방식 -> VM 보다는 고성능이다, 근데 비용이 추가로 든다.

    > 하이퍼 바이저가 여러개의 OS를 관리하고 하나의 하드웨어를 공유하기 때문에 느릴 수 밖에 없다.
    > 이거 때문에 가끔 클라우드가 내가 원하는 대로 동작하지 않을 때가 있다.
    > <br> 이게 싫은 상황일 떄 비용 조금 더 주고 안정적으로 쓰고 싶을 때 Bare Metal을 사용
    > 국내 Cloud에서 Bare Metal을 주는 것을 장점으로 내새우는 곳도 있다.

- `CPU vs vCPU`
    - CPU : 실제 하드웨어 자원이며 물리적인 서버에서 실제 연산
    - vCPU : 가상화 환경에서 물리적 CPU 자원을 추상화한 자원으로 VM에 할당된 가상 자원 (클라우드에서 사용하는 CPU라고 생각하자 ?)

- 가상화 기술 기반의 비즈니스
    - 클라우드 서비스 : 각종 자원들을 가상화하여 서비스로 제공 (서버 가상화, 네트워크 가상화, 스토리지 가상화 등)
    - 플랫폼 기반 서비스 : 본인의 애플리케이션을 쉽게 업로드하여 서비스 활용 (이미 서버는 준비되어 있고 애플리케이션만 그 플랫폼에 올려서 사용) -> 플랫폼 서비스가 알아서 할당
    - 솔루션 기반 서비스 : 사용자의 니즈가 반영된 애플리케이션이 가상화된 자원을 할당받아 곧바로 서비스가 제공 -> 보통 대부분으 ㅣ서비스

- IaaS (이아스)
    - Infrastructure as Service
    - 보통 클라우드 서비스
    - CSP(Cloud Service Provider)로 불린다
    - 네이버 클라우드, 구글 클라우드 같은 것임

- PaaS (파스)
    - Platform as a Service
    - 거의 풀스택 개발자가 사용한다.
    - Heroku, Vercel, Netlify 등이 있음

- SaaS (사스)
    - 사용자는 곧바로 서비스를 이용할 수 있는 구조이며 클라우드 기반으로 사용량에 따른 과금 정책이 대부분이다.
    - 우리가 아는 대부분의 서비스들이 현재 SaaS이다.

<img src="../img/0703-1.png">

> 우리가 집중적으로 이해해야 하는 부분은 IaaS / SaaS
> <br> 대부분의 기업은 IaaS를 통해 SaaS를 출시하기 때문에 대부분의 클라우드 엔지니어는 IaaS를 다루어 SaaS를 개발한다.
> IaaS를 하는 기업은 주로 대기업 (Bic Tech) 위주이다. (카카오, 네이버) <br>
> 보통 클라우드 시장을 볼 때는 IaaS / PaaS / SaaS로 나누어서 보며 IaaS 시장에서 가장 많이 사용되는 서비스는 현재 AWS이다.
> OpenStack 오픈소스에서 IaaS를 만들 수도 있다. 클라우드 엔지니어는 IaaS를 주로 활용하는 역할을 한다.

- IaaS 서비스들의 기본 기능들 (대부분 클라우드 서비스에서는 이렇게 제공한다. 비슷하게 ...!)
    - Compute
    - Network
    - Storage
    - Container
    - Database
    - Security
    - AI
    - 등등

- 클라우드 서비스의 이런 많은 기능을 어떻게 사용해야 할까? 
    - 자주 사용하는 기능
        - 가장 기본적으로는 Network를 이용하여 네트워크 구조 세팅
        - 세팅된 Network 위에 Compute를 이용하여 위에 필요한 서버를 구축 진행
        - DB를 이용하여 애플리케이션과 데이터베이스 연결
        - Storage를 이용하여 애플리케이션에서 나오는 로그와 같은 파일들을 저장
    - 그 외의 기능
        - Security를 통해 보안 강화
        - AI를 통해 서비스 붙이기
        - 즉, 이외에는 필요한 것들을 찾아 붙이는 방식
    
    > 자주 사용하는 기능은 무조건 쓰고 나머지 기능은 그냥 검색해서 붙인다. 
    
    ```
    region은 데이터센터 기준으로 생성
    region을 설정하고 네트워크 설정을 한다. 지금은 보통 default로 사용하지만 실무에서는 99.9%로 다시 세팅한다.
    그래서 네트워크 관리에 대한 실습을 빨리 실습해 봐야한다. 이런 것은 애플리케이션을 중점으로 봐야한다. 
    클라우드 내에서 영업하는 직군도 있다?
    ```

- 클라우드 아키텍처를 그리기 위한 필요 배경지식
    - OS (Operating System)
        - 자주 사용 OS : Windows, MacOS 등
        - 자주 사용하는 서버 OS는 Linux 계열로 그 안에서 Ubuntu가 가장 기본적으로 많다.
        - 애플리케이션이 실행 가능한 OS 내에서 가장 최적화된 OS를 선택하는 것도 중요하다.

    - 네트워크
        - 보통 Region 먼저 선택
        - VPC (Virtual Private Cloud) -> 네트워크 가상화
        - Subnet을 통해 가상 네트워크 공간을 한번 더 IP 기분으로 논리적으로 나눈다. 
        - 네트워크 배경지식 : L4/L7(OSI 계층), VPC, Subnet, Protocol, IP, Port

    - 파일시스템
        - 우리가 아는 파일시스템은 흔히 Harddisk나 SSD
        - 클라우드에서도 서버에 용량을 붙일 때 Harddisk로 붙일지, SSD로 붙일지 선택
        - 서버에 파일시스템을 붙일 때는 Network Block으로 만들어 붙인다.
        - 따라서, VM에 있는 파일시스템 성능과 로컬 파일시스템 성능이 다를 수 있다.
        - NFS(Network File System), HBD(Network Block Device)와 같은 파일시스템에 대한 가상화도 많이 활용된다.

    - VM (Virtual Machine)
        - 가상화된 서버
        - 보통 OnDemand 형태로 필요한 만큼 사용하거나 1년이나 3년 비용을 미리 할인된 가격으로 내는 Reserved 방식으로 활용
        - 이외로 Spot Instance 형태로 최대로 70% 할인된 가격으로 사용도 가능하지만 해당 방법은 AWS가 관리하는 리소스 내에서 리소스가 남을 때
        잠깐 빌려주는 형태이다보니 강제로 서버가 회수될 수 있다.
    
    - LB (Load Balancer)
        - 네트워크 트래픽을 여러 서버로 분산시키는 역할
        - 가용성 및 안정성을 위해서 서버를 이중화 할 때, 가장 많이 사용되는 서비스
        - 서버의 이중화를 통한 HA(High Availability)를 책임집니다.
        - 물론, LB도 서비스이기 때문에 LB도 트래픽이 너무 몰리면 느려질 수 있다.
        - 그래서 트래픽이 몰릴 것을 예상했을 때는, 서버도 늘리지만, LB에 미리 부하를 줘서 LB를 구성하는 서버도 미리 늘려놓는 걸 Pre-Warming 또는 Warm-Up이라고 부른다. -> 미리 대규모 트래픽을 보내 놓으면 
        LB가 서버를 늘려놓는다. 단, 예측할 수 있어야 한다. 
        - 우리가 흔히 대규모 트래픽을 처리할 때 보통 LB를 고려한다. LB를 Scale Out하는 것을 해야한다. 
        - LB 없을 떄 대규모 트래픽을 처리하는 것도 연습해야 한다. On-premise에서도 처리할 수 있는 방식도 있다.

    - 데이터베이스
        - 애플리케이션의 데이터를 저장하고 관리하는 서비스
        - 라이선스 규정에 의해, 데이터베이스 오픈소스를 보통 그대로 서비스 해주기 보다는 비슷한 서비스를 자체적으로 만들어 공급하는 경우가 많다. (예: DynamoDB)
        - 물론 오픈소스를 직접 운영해주는 케이스도 있다. (예: Amazon RDS for MySQL, Elasticache)
        - AWS는 거의 최신 버전을 계속 업데이트 해주지만, 많은 클라우드 서비스들이 오픈소스 버전업을 사실 유지보수 시켜주지 않을 때가 많다.

    - CDN (Content Delivry Network)
        - 자주 바뀌지 않는 리소스들을 `캐싱하여` 데이터를 전달하는 서비스
        - 서버에서 리소스를 전달하면, 그 만큼 서버의 트래픽이 나가는데 이 트래픽을 CDN이 대신 책임져준다면 서버의 부담이 낮아진다. (보통 트래픽이 많이 몰리면, CPU가 오르고 그럼 느려질 수 있다.)
        - 캐싱을 쓰기 때문에 서버가 리소스를 전달하는 것보다 효율적이다.
        - 따라서, 캐싱을 많이 활용할 수록 효율적이니 자주 바뀌지 않는 리소스를 올리는게 좋다. (보통 Image)


    - MSA (Micro Service Architecture)
        - 애플리케이션들을 작은 독립적인 서비스들로 분할하여 운영하는 아키텍처
        - 애플리케이션들이 하나의 독립적인 서비스로 운영되기 위해서는 VM이나 Container를 이용하여 운영되어야 한다.
        - 보통 VM에 직접 올리는 형태에서 VM에 Container를 올려 운영하다가, 최종적으로는 EKS와 같은 쿠버네티스 시스템을 활용하는 형태로 고도화된다.

- 클라우드 아키텍처를 쉽게 그리는 법은 없을까? 
    - 클라우드 기능들도 이해했고, 아키텍처를 그릴 때 어떤 식인지 예제를 통해 알겠으나, 혹시 쉽게 그릴 수 있는 방법은 없을까?
    - 많은 서비스들이 보통 다층 구조를 겪으면서 발전하고 있어, 이를 따르면 쉽게 그릴 수 있다.
    - Multi-Tier Architecture : 소프트웨어 애플리케이션을 논리적으로 분리된 여러 계층을 나누어 구성하는 아키텍처 스타일 -> 보통 프레젠테이션 계층(FE), 애플리케이션 계층(BE), 데이터 게층(DB)으로 나뉜다.

- 1 Tier Architecture
    - 쉽게 생각해서 FE, BE, DB가 하나의 VM에서 돌고 있는 상황
    - 해당 VM이 죽는다면, 모든 서버가 죽을테니 가장 큰 이슈일 수 있으나, 해당 VM만 빠르게 살린다면 반대로 모든 서버를 한번에 살릴 수도 있다.

- 2 Tier Architecture
    - FE 서버, BE 서버 구분 없이 하나의 서버에서 데이터베이스와 연결된 상황
    - 현실적으로 많은 아키텍처가 이런 모습을 띈다. 안정성도 잡을 수 있고, 서버 종류가 많지 않아 관리에 용이하다.
    - 단점 : BE에 조금만 에러가 나더라도 FE에 영향을 미친다.
    
    <img src="../img/0703-2.png">

- 3 Tier Architecture
    - FE, BE 서버를 구별하여 벡엔드 서버에서 데이터베이스와 연결된 상황
    - 인프라 운영에 노하우가 있고 제품을 이해하고 있는 상황이라면 가장 나은 방식이다.
    - 가장 최종적인 목표가 되는 아키텍처

    <img src="../img/0703-3.png">

- N Tier Architecture
    - 백엔드의 역할을 다양하게 나누어 서로 API로 통신하게 만드는 형태
    - 최종적으로 대부분의 SaaS가 해당 형태로 운영된다.

- 다층 구조의 핵심은 데이터와 비용 설계
    - 비즈니스 상황을 고려하여 티어 선택만해도 클라우드 아키텍처 설계가 쉬워짐
    - 애플리케이션이 너무 커져서 만약 모듈들을 여러 애플리케이션으로 쪼갠다면, 보통 쪼개는 기준은 데이터 기반이 가장 보편적이다. (결제 시스템, 유저 시스템 등등)

- 정리
    - 클라우드를 이해하기 위한 기본 개념과 가상화 개념 이해하기
    - 클라우드는 보통 IaaS, PaaS, SaaS으로 구별
    - 우리가 집중할 부분은 IaaS 중심. 우리가 보통 만드는 서비스는 SaaS 중심.
    - 클라우드의 다양한 기능을 클라우드 아키텍처로 작성 능력이 필요











